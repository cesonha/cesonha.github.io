(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[717],{6300:function(e,t,r){(window.__NEXT_P=window.__NEXT_P||[]).push(["/admin/photos",function(){return r(5607)}])},2346:function(e,t,r){"use strict";async function a(e){try{let{title:t,content:r,excerpt:a,tags:s,slug:c}=e;if(!t||!r||!c)throw Error("Title, content, and slug are required");let l=await fetch("/api/admin/create-post",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({title:t,content:r,excerpt:a,tags:s,slug:c})}),o=await l.json();if(!l.ok)throw Error(o.message||"Failed to create post");return{success:!0,message:o.message||"Post created successfully!",preview:o.preview}}catch(e){return console.error("Error creating post:",e),{success:!1,message:"Error creating post: ".concat(e.message)}}}async function s(e){try{let{title:t,description:r,slug:a,photos:s,isEdit:c=!1}=e;if(!t||!a)throw Error("Title and slug are required");let l=await fetch("/api/admin/create-album",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({title:t,description:r,slug:a,photos:s,isEdit:c})}),o=await l.json();if(!l.ok)throw Error(o.message||"Failed to create album");return{success:!0,message:o.message||"Album ".concat(c?"updated":"created"," successfully!"),preview:o.preview}}catch(t){return console.error("Error with photo album:",t),{success:!1,message:"Error ".concat(e.isEdit?"updating":"creating"," album: ").concat(t.message)}}}r.d(t,{I:function(){return a},P:function(){return s}})},5607:function(e,t,r){"use strict";r.r(t),r.d(t,{default:function(){return n}});var a=r(5893),s=r(7294),c=r(1163),l=r(1664),o=r.n(l),i=r(2346);function n(){let[e,t]=(0,s.useState)(!1),r=(0,c.useRouter)(),[l,n]=(0,s.useState)("create"),[d,u]=(0,s.useState)(""),[m,p]=(0,s.useState)(""),[h,x]=(0,s.useState)(""),[b,g]=(0,s.useState)([{src:"",caption:""}]),[f,y]=(0,s.useState)(""),[j,v]=(0,s.useState)(!1),[N,w]=(0,s.useState)([]),[k,E]=(0,s.useState)("");(0,s.useEffect)(()=>{t(!1),r.push("/")},[r]),(0,s.useEffect)(()=>{d&&"create"===l&&x(d.toLowerCase().replace(/[^\w\s-]/g,"").replace(/\s+/g,"-").replace(/-+/g,"-"))},[d,l]),(0,s.useEffect)(()=>{k&&"edit"===l&&fetch("/api/admin/get-album?id=".concat(k)).then(e=>e.json()).then(e=>{if(e.success){var t;let r=e.album;u(r.title||""),p(r.description||""),x(k),g((null===(t=r.photos)||void 0===t?void 0:t.map(e=>({src:e.src||"",caption:e.caption||""})))||[{src:"",caption:""}])}else y("Error: ".concat(e.message))}).catch(e=>{console.error("Error loading album:",e),y("Error: Could not load album data")})},[k,l]);let C=(0,s.useRef)(null),S=async e=>{if(!e.target.files||0===e.target.files.length)return;let t=e.target.files[0];if(!t)return;e.target.value="";let r=b.length,a=[...b];""!==a[a.length-1].src?a.push({src:"uploading",caption:""}):a[a.length-1].src="uploading",g(a);try{let e=new FormData;e.append("file",t);let a=await fetch("/api/admin/upload-photo?albumSlug=".concat(h||"temp"),{method:"POST",body:e}),s=await a.json();if(a.ok&&s.success){let e=[...b];e[r]?e[r].src=s.photoPath:e.push({src:s.photoPath,caption:""}),g(e),y("Photo uploaded successfully: ".concat(s.photoPath))}else{let e=b.filter((e,t)=>t!==r||"uploading"!==e.src);g(e),y("Error: ".concat(s.message||"Failed to upload photo"))}}catch(e){console.error("Error uploading file:",e),g(b.filter((e,t)=>t!==r||"uploading"!==e.src)),y("Error: ".concat(e.message))}},P=e=>{let t=[...b];t.splice(e,1),g(t)},A=(e,t,r)=>{let a=[...b];a[e][t]=r,g(a)},_=async e=>{e.preventDefault(),v(!0),y("");try{let e=await (0,i.P)({title:d,description:m,slug:h,photos:b.filter(e=>""!==e.src.trim()),isEdit:"edit"===l});e.success?(y(e.message),console.log("Preview of album data:",e.preview)):y("Error: ".concat(e.message))}catch(e){y("Error: ".concat(e.message))}finally{v(!1)}},T=e=>{n(e),y(""),"create"===e&&(u(""),p(""),x(""),g([{src:"",caption:""}]),E(""))};return e?(0,a.jsxs)("div",{className:"max-w-4xl mx-auto py-8",children:[(0,a.jsxs)("div",{className:"flex justify-between items-center mb-6",children:[(0,a.jsx)("h1",{className:"text-3xl font-bold text-primary-light",children:"create"===l?"Create Photo Album":"Edit Photo Album"}),(0,a.jsx)(o(),{href:"/admin",legacyBehavior:!0,children:(0,a.jsx)("a",{className:"text-primary-light hover:text-primary-hover cursor-pointer",children:"Back to Dashboard"})})]}),(0,a.jsxs)("div",{className:"flex space-x-4 mb-6",children:[(0,a.jsx)("button",{onClick:()=>T("create"),className:"px-4 py-2 rounded ".concat("create"===l?"bg-primary text-text-primary":"bg-dark-lighter text-text-secondary hover:bg-dark-card"),children:"Create New Album"}),(0,a.jsx)("button",{onClick:()=>T("edit"),className:"px-4 py-2 rounded ".concat("edit"===l?"bg-red-500 text-white":"bg-gray-700 text-gray-300 hover:bg-gray-600"),children:"Edit Existing Album"})]}),f&&(0,a.jsx)("div",{className:"p-4 mb-6 rounded ".concat(f.includes("Error")?"bg-red-900/50 text-primary-lighter":"bg-green-900/50 text-green-200"),children:f}),"edit"===l&&(0,a.jsxs)("div",{className:"mb-6",children:[(0,a.jsx)("label",{htmlFor:"existingAlbum",className:"block text-text-secondary mb-2",children:"Select Album to Edit"}),(0,a.jsxs)("select",{id:"existingAlbum",value:k,onChange:e=>E(e.target.value),className:"w-full p-2 bg-dark-card border border-dark-border rounded text-text-primary",required:!0,children:[(0,a.jsx)("option",{value:"",children:"-- Select an album --"}),N.map(e=>(0,a.jsx)("option",{value:e.id,children:e.title},e.id))]})]}),(0,a.jsxs)("form",{onSubmit:_,className:"space-y-6",children:[(0,a.jsxs)("div",{children:[(0,a.jsx)("label",{htmlFor:"title",className:"block text-text-secondary mb-2",children:"Album Title"}),(0,a.jsx)("input",{type:"text",id:"title",value:d,onChange:e=>u(e.target.value),className:"w-full p-2 bg-dark-card border border-dark-border rounded text-text-primary",required:!0})]}),(0,a.jsxs)("div",{children:[(0,a.jsx)("label",{htmlFor:"slug",className:"block text-text-secondary mb-2",children:"Slug (file name)"}),(0,a.jsx)("input",{type:"text",id:"slug",value:h,onChange:e=>x(e.target.value),className:"w-full p-2 bg-dark-card border border-dark-border rounded text-text-primary",required:!0,readOnly:"edit"===l}),"edit"===l&&(0,a.jsx)("p",{className:"text-text-muted text-sm mt-1",children:"Slug cannot be changed when editing"})]}),(0,a.jsxs)("div",{children:[(0,a.jsx)("label",{htmlFor:"description",className:"block text-text-secondary mb-2",children:"Description"}),(0,a.jsx)("textarea",{id:"description",value:m,onChange:e=>p(e.target.value),className:"w-full p-2 bg-dark-card border border-dark-border rounded text-text-primary h-20"})]}),(0,a.jsxs)("div",{children:[(0,a.jsxs)("div",{className:"flex justify-between items-center mb-2",children:[(0,a.jsx)("label",{className:"text-text-secondary",children:"Photos"}),(0,a.jsx)("button",{type:"button",onClick:()=>{C.current&&C.current.click()},className:"px-2 py-1 bg-dark-lighter text-text-primary rounded hover:bg-dark-card text-sm",children:"Add Photo"}),(0,a.jsx)("input",{type:"file",ref:C,onChange:S,accept:"image/*",className:"hidden"})]}),(0,a.jsx)("div",{className:"space-y-4",children:b.map((e,t)=>(0,a.jsxs)("div",{className:"p-4 border border-dark-border rounded",children:[(0,a.jsxs)("div",{className:"flex justify-between items-center mb-2",children:[(0,a.jsxs)("h3",{className:"text-text-secondary",children:["Photo ",t+1]}),b.length>1&&(0,a.jsx)("button",{type:"button",onClick:()=>P(t),className:"text-primary-light hover:text-primary-hover text-sm",children:"Remove"})]}),(0,a.jsxs)("div",{className:"mb-2",children:[(0,a.jsx)("label",{className:"block text-text-muted mb-1 text-sm",children:"Image URL (relative to public folder)"}),(0,a.jsxs)("div",{className:"flex",children:[(0,a.jsx)("input",{type:"text",value:"uploading"===e.src?"Uploading...":e.src,onChange:e=>A(t,"src",e.target.value),placeholder:"images/photos/album-name/photo1.jpg",className:"w-full p-2 bg-dark-card border border-dark-border rounded-l text-text-primary ".concat("uploading"===e.src?"opacity-50":""),disabled:"uploading"===e.src}),(0,a.jsx)("button",{type:"button",onClick:()=>{C.current&&C.current.click()},className:"px-3 py-2 bg-dark-lighter text-text-primary rounded-r hover:bg-dark-card text-sm",children:"Browse"})]}),e.src&&"uploading"!==e.src&&(0,a.jsx)("div",{className:"mt-2",children:(0,a.jsx)("img",{src:e.src,alt:"Preview",className:"h-20 object-cover rounded border border-dark-border",onError:e=>{e.target.onerror=null,e.target.src="/placeholder-image.jpg",e.target.classList.add("opacity-50")}})})]}),(0,a.jsxs)("div",{children:[(0,a.jsx)("label",{className:"block text-text-muted mb-1 text-sm",children:"Caption"}),(0,a.jsx)("input",{type:"text",value:e.caption,onChange:e=>A(t,"caption",e.target.value),className:"w-full p-2 bg-dark-card border border-dark-border rounded text-text-primary"})]})]},t))})]}),(0,a.jsx)("button",{type:"submit",disabled:j||"edit"===l&&!k,className:"px-4 py-2 bg-red-500 text-white rounded hover:bg-red-600 disabled:opacity-50",children:j?"create"===l?"Creating...":"Updating...":"create"===l?"Create Album":"Update Album"})]})]}):(0,a.jsx)("div",{children:"Loading..."})}}},function(e){e.O(0,[888,774,179],function(){return e(e.s=6300)}),_N_E=e.O()}]);